---
- name: "backup - install software"
  zypper:
    name:   [ 'borgbackup' ]
    state:  present

- name: "backup - /backup directory"
  file:
    path: /backup
    state: directory

- name: "backup - /usr/local/bin directory"
  file:
    path:   /usr/local/bin
    state:  directory

- name: "backup - backup script for suse systems"
  template:
    src:      "backup.j2"
    dest:     "/usr/local/bin/backup"
    mode:     0755
    owner:    root
    group:    root

- name: "backup - /etc/cron.daily/backup"
  copy:
    dest:   "/etc/cron.daily/backup"
    mode:   0755
    content: |
      #/bin/bash
      sleep $((RANDOM%15+5))m
      /usr/local/bin/backup -b
  when: enable_backup

- name: "backup - /etc/cron.daily/backup"
  file:
    dest:   "/etc/cron.daily/backup"
    state:  absent
  when: not enable_backup
